---
title: 笔记：MySQL技术内幕-03
date: 2020-04-14
categories: 
  - 笔记
tags: 
  - 数据库
---

<html>
<head>
  <title></title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/604762 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5721"/>

<div>
<span><div><div><hr/><div><span style="font-weight: bold;">慢查询日志</span></div><div>1.慢查询日志(先打开开关，再修改时间)</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mysql&gt; show variables like '%slow_query%'\g;</div><div>+---------------------+-----------------------------------+</div><div>| Variable_name       | Value                             |</div><div>+---------------------+-----------------------------------+</div><div>| slow_query_log      | OFF                               |</div><div>| slow_query_log_file | /var/lib/mysql/localhost-slow.log |</div><div>+---------------------+-----------------------------------+</div><div><br/></div><div>mysql&gt; show variables like '%long_query%'\g;</div><div>+-----------------+-----------+</div><div>| Variable_name   | Value     |</div><div>+-----------------+-----------+</div><div>| long_query_time | 10.000000 |</div><div>+-----------------+-----------+</div></div><div><br/></div><div>2.慢查询日志，也可记录没有使用索引</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mysql&gt; show variables like 'log_queries%'\g;</div><div>+-------------------------------+-------+</div><div>| Variable_name                 | Value |</div><div>+-------------------------------+-------+</div><div>| log_queries_not_using_indexes | OFF   |</div><div>+-------------------------------+-------+</div></div><div><br/></div><div>分析慢查询日志工具 </div><div>mysqldumpslow</div><div><br/></div><div>3.也可以表格形式查看慢查询日志（表 mysql.slow_log）</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mysql&gt; show variables like 'log_output';</div><div>+---------------+-------+</div><div>| Variable_name | Value |</div><div>+---------------+-------+</div><div>| log_output    | FILE  |</div><div>+---------------+-------+</div></div><div><br/></div><div>4.也可根据逻辑IO读取次数记录慢查询(没有找到变量)</div><div>slow_query_type<span>    </span><span>    启用slow log的方式</span></div><div><span>long_query_io<span>    </span><span>    </span><span>    限定的逻辑IO次数，用于记录为slow log</span></span></div><div><br/></div><div><br/></div></div><hr/><div><b>binlog 二进制日志</b></div><div>默认不启用</div><div>待补充</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mysql&gt; show variables like '%binlog%'\g;</div><div>+-----------------------------------------+----------------------+</div><div>| Variable_name                           | Value                |</div><div>+-----------------------------------------+----------------------+</div><div>| binlog_cache_size                       | 32768                |</div><div>| binlog_checksum                         | CRC32                |</div><div>| binlog_direct_non_transactional_updates | OFF                  |</div><div>| binlog_error_action                     | IGNORE_ERROR         |</div><div>| binlog_format                           | STATEMENT            |</div><div>| binlog_gtid_simple_recovery             | OFF                  |</div><div>| binlog_max_flush_queue_time             | 0                    |</div><div>| binlog_order_commits                    | ON                   |</div><div>| binlog_row_image                        | FULL                 |</div><div>| binlog_rows_query_log_events            | OFF                  |</div><div>| binlog_stmt_cache_size                  | 32768                |</div><div>| binlogging_impossible_mode              | IGNORE_ERROR         |</div><div>| innodb_api_enable_binlog                | OFF                  |</div><div>| innodb_locks_unsafe_for_binlog          | OFF                  |</div><div>| max_binlog_cache_size                   | 18446744073709547520 |</div><div>| max_binlog_size                         | 1073741824           |</div><div>| max_binlog_stmt_cache_size              | 18446744073709547520 |</div><div>| simplified_binlog_gtid_recovery         | OFF                  |</div><div>| sync_binlog                             | 0                    |</div><div>+-----------------------------------------+----------------------+</div></div><div><br/></div><hr/><div><b>表空间文件</b></div><div>1.共享表空间的文件</div><div>=&gt; 默认12M，可指定到不同的空间</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mysql&gt; show variables like '%innodb_data%'\g;</div><div>+-----------------------+------------------------+</div><div>| Variable_name         | Value                  |</div><div>+-----------------------+------------------------+</div><div>| innodb_data_file_path | ibdata1:12M:autoextend |</div><div>| innodb_data_home_dir  |                        |</div><div>+-----------------------+------------------------+</div></div><div><br/></div><div>2.为每个表创建独立的表空间文件（默认打开），<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">文件后缀为.ibd</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mysql&gt; show variables like '%innodb_file_per%'\g;</div><div>+-----------------------+-------+</div><div>| Variable_name         | Value |</div><div>+-----------------------+-------+</div><div>| innodb_file_per_table | ON    |</div><div>+-----------------------+-------+</div></div><div><br/></div><div><br/></div><hr/><div><b>redo 重做日志文件</b></div><div>1.至少有1个重做日志文件组，每个组下至少有2个日志文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>| innodb_log_file_size        | 50331648 |</div><div>| innodb_log_files_in_group   | 2</div></div><div><br/></div><div>2.为提供高可用性，可设置多个镜像日志组，采用循环写方式</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>| innodb_log_group_home_dir  | ./    |</div><div>| innodb_mirrored_log_groups | 1     |</div></div><div><br/></div><div>3.对比binlog和redolog</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1.归属不同：binlog记录mysql所有日志，redolog只记录innodb的事务日志；</div><div>2.目标不同：binlog记录逻辑日志，而redolog记录关于页page的更改物理情况；</div><div>3.写入时间不同：binlog在提交时写，redolog不断写；</div></div><div><br/></div><div><br/></div><div><br/></div></div></span>
</div></body></html> 
